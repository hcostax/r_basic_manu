<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Graphics for Communication</title>
    <meta charset="utf-8" />
    <meta name="author" content="Alison Hill" />
    <meta name="date" content="2020-10-06" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/my-theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/my-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">







class: title-slide, center, middle

&lt;span class="fa-stack fa-4x"&gt;
  &lt;i class="fa fa-circle fa-stack-2x" style="color: #ffffffcc;"&gt;&lt;/i&gt;
  &lt;strong class="fa-stack-1x" style="color:#3b4245;"&gt;03&lt;/strong&gt;
&lt;/span&gt; 

# Graphics for Communication

## R Markdown for Pharma

### Alison Hill &amp;#183; RStudio

#### [rmd4pharma.netlify.app/](https://rmd4pharma.netlify.app/)

---
class: middle, center

# &lt;i class="fas fa-cloud"&gt;&lt;/i&gt;

# Go here and log in (free):

&lt;https://rstd.io/rmd4pharma-cloud&gt;

---
layout: true

&lt;div class="my-footer"&gt;&lt;span&gt;https://rmd4pharma.netlify.app/&lt;/span&gt;&lt;/div&gt;


---
exclude: true

at this point, we should be within a bookdown with html and word doc output options?

Or an rticles with bookdown under the hood?

---
class: inverse, middle


.pull-left[

![](https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/ggplot2.png)&lt;!-- --&gt;

]

--

.pull-right[

[`ggplot2` package](https://ggplot2.tidyverse.org/)

[`ggplot2` cheatsheet](https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf)

[R4DS chapter](https://r4ds.had.co.nz/data-visualisation.html)

]

---
class: middle, center, inverse

&lt;span class="fa-stack fa-4x"&gt;
  &lt;i class="fa fa-circle fa-stack-2x" style="color: #fff;"&gt;&lt;/i&gt;
  &lt;strong class="fa-stack-1x" style="color:#2f5275;"&gt;1 &lt;/strong&gt;
&lt;/span&gt; 

# Get figures in

---
class: your-turn

# Your turn: Part 1 of 2

**WARM-UP**: open `03-draft.Rmd` and read the source file. It has several figures coded using the `ggplot2` package.

1. Knit the document to the `bookdown::html_document2` format &amp;mdash; behold!

1. Add output options to this format to use one of the [bootswatch themes](https://rmarkdown.rstudio.com/docs/reference/html_document.html) and include a [floating table of contents](https://rmarkdown.rstudio.com/docs/reference/html_document.html#floating-table-of-contents). *(hint: `?html_document`)*

1. Knit to `bookdown::word_document2` (no options)- how does it look?

1. Add `distill::distill_article` as an output format (consider adding a TOC too) and knit- what differences do you see between this and the `bookdown::html_document2` format?

_psst...next slide has answers..._

<div class="countdown" id="timer_5f7d4026" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


---
class: your-turn

# Answer

.pull-left[
```yaml
---
output:
  bookdown::html_document2:
    theme: flatly
    toc: true
    toc_float: true
  bookdown::word_document2: default
  distill::distill_article:
    toc: true
---
```
]

.pull-right[
````
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  comment = NA,
  R.options = list(width = 70)
)
```
````

Distill is much less chatty than other outputs due to default `knitr` code chunk options: https://rstudio.github.io/distill/basics.html#code-blocks

]

---
class: middle, center

# The line-up

&lt;img src="03-graphics_files/figure-html/unnamed-chunk-4-1.png" width="25%" /&gt;&lt;img src="03-graphics_files/figure-html/unnamed-chunk-4-2.png" width="25%" /&gt;&lt;img src="03-graphics_files/figure-html/unnamed-chunk-4-3.png" width="25%" /&gt;&lt;img src="03-graphics_files/figure-html/unnamed-chunk-4-4.png" width="25%" /&gt;

---

# Including plots

.pull-left[

```r
# PLOT: Age distribution -------------------------------------------------------
ggplot(mockdata, aes(age)) +
  geom_histogram(color = 'white',
                 fill = scico(1, 
                              begin = .3, 
                              palette = "berlin"),
                 bins = 20) +
  labs(x = "Age", 
       y = "Count") +
  scale_y_continuous(
    breaks = scales::pretty_breaks()
  )
```

Will this print?

]

--

.pull-right[
![](03-graphics_files/figure-html/unnamed-chunk-5-1.png)&lt;!-- --&gt;

]

---

# Including plots

.pull-left[

```r
# PLOT: Age distribution -------------------------------------------------------
age_histogram &lt;- 
  ggplot(mockdata, aes(age)) +
  geom_histogram(color = 'white',
                 fill = scico(1, 
                              begin = .3, 
                              palette = "berlin"),
                 bins = 20) +
  labs(x = "Age", 
       y = "Count") +
  scale_y_continuous(
    breaks = scales::pretty_breaks()
  )
```

What about this?

]

--

.pull-right[


]


---

# Including plots

.pull-left[

```r
# PLOT: Age distribution -------------------------------------------------------
age_histogram &lt;- 
  ggplot(mockdata, aes(age)) +
  geom_histogram(color = 'white',
                 fill = scico(1, 
                              begin = .3, 
                              palette = "berlin"),
                 bins = 20) +
  labs(x = "Age", 
       y = "Count") +
  scale_y_continuous(
    breaks = scales::pretty_breaks()
  )
age_histogram
```

]

--

.pull-right[
![](03-graphics_files/figure-html/unnamed-chunk-7-1.png)&lt;!-- --&gt;

]

???


so, how did we get a figure into R Markdown?

Answer: it has to print!

---
class: middle, center, inverse

&lt;span class="fa-stack fa-4x"&gt;
  &lt;i class="fa fa-circle fa-stack-2x" style="color: #fff;"&gt;&lt;/i&gt;
  &lt;strong class="fa-stack-1x" style="color:#2f5275;"&gt;2 &lt;/strong&gt;
&lt;/span&gt; 

# Chunk options for plots

---

# Chunk options for plots

- fig resolution
- fig size
- [fig "device"](https://r4ds.had.co.nz/graphics-for-communication.html#other-important-options)

.footnote[https://yihui.name/knitr/options/#plots]


---

# Figure resolution

.pull-left[


```r
# PLOT: Age distribution -------------------------------------------------------
age_histogram &lt;- 
  ggplot(mockdata, aes(age)) +
  geom_histogram(color = 'white',
                 fill = scico(1, 
                              begin = .3, 
                              palette = "berlin"),
                 bins = 20) +
  labs(x = "Age", 
       y = "Count") +
  scale_y_continuous(
    breaks = scales::pretty_breaks()
  )
age_histogram
```

]

.pull-right[
![](03-graphics_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;

]

---

# fig.retina

.pull-left[

````
```{r}
age_histogram
```
````

&lt;img src="03-graphics_files/figure-html/unnamed-chunk-10-1.png" width="70%" /&gt;
]

--

.pull-right[

````
```{r fig.retina=3}
age_histogram
```
````

&lt;img src="03-graphics_files/figure-html/unnamed-chunk-11-1.png" width="70%" /&gt;
]

---

# out.width

.pull-left[

````
```{r fig.retina=3, out.width="70%"}
age_histogram
```
````

&lt;img src="03-graphics_files/figure-html/unnamed-chunk-12-1.png" width="70%" /&gt;
]

--

.pull-right[

````
```{r fig.retina=3, out.width="10%"}
age_histogram
```
````

&lt;img src="03-graphics_files/figure-html/unnamed-chunk-13-1.png" width="10%" /&gt;

See also:

+ `fig.width`
+ `fig.height` 
+ `fig.asp`

https://r4ds.had.co.nz/graphics-for-communication.html#figure-sizing

]


---

# fig.cap

For the `ae_pct_plot`, I followed [these recommendations](https://www.bmj.com/content/355/bmj.i5078).

````
```{r fig.cap="BMJ, 2016 paper", echo=FALSE}
knitr::include_graphics(here::here("images/F3.large.jpg"))
```
````



&lt;div class="figure"&gt;
&lt;img src="/Users/alison/rworkshops/rmd4pharma/static/slides/images/F3.large.jpg" alt="BMJ, 2016 paper" width="25%" /&gt;
&lt;p class="caption"&gt;BMJ, 2016 paper&lt;/p&gt;
&lt;/div&gt;

???

This is how you can also add static figures. You could use R Markdown, but with knitr you can also include a figure caption. As you might have noticed in your output, this ends up numbered. 

---
class: live-code

# Live code demo

We open up `03-draft.Rmd` and take the static image and together we:

1. Label that chunk

1. Add a cross-reference like `see Figure \@ref(fig:bmj)`

1. Try again with `counts-by-site` code chunk: `see Figure \@ref(fig:counts-by-site)` _(watch what happens if try to cross-reference without a caption!)_

.footnote[Cross-referencing only works in these output packages: distill, bookdown, blogdown]

---

# Caption a figure

````
```{r age-plot, echo=FALSE, fig.cap='Age distributions'}
age_histogram
```
````

.center[

&lt;img src="03-graphics_files/figure-html/age-plot-1.png" width="25%" /&gt;

**Fig. 1:** Age distributions

]



---

# Cross-reference a figure

.pull-left[

See Figure `\@ref(fig:age-plot)`.

````
```{r age-plot, echo=FALSE, fig.cap='Age distributions'}
age_histogram
```
````

]

.pull-right[

See Figure [1]().

.center[

&lt;div class="figure"&gt;
&lt;img src="03-graphics_files/figure-html/unnamed-chunk-15-1.png" alt="Age distributions" width="70%" /&gt;
&lt;p class="caption"&gt;Age distributions&lt;/p&gt;
&lt;/div&gt;

]

]

---

# Key takeaway

Once you have:

✔️ A labeled chunk that produces a plot

✔️ A figure caption using `fig.cap`

Then you can have:

### Cross-references!*

.footnote[\* and you are using distill, bookdown, or blogdown output formats]

---
class: your-turn

# Your turn: Part 2 of 2

Now go through `03-draft-revised.Rmd` and read the source, then knit.

.pull-left[


```r
# demographics-----------------------------
age_density # multi-panel?    &lt;-ignore this
age_boxplot # multi-panel?    &lt;-ignore this
demo_tab

# treatment response @ follow-up-----------
surv_pct_plot # multi-panel?  &lt;-ignore this
surv_days_plot # multi-panel? &lt;-ignore this
fu_tab

# adverse events---------------------------
ae_pct_plot
ae_tab
```
]

.pull-right[
1. Add new code chunks containing tables and plots where you want.

1. Edit the code chunk options as you need to.

1. Add headers and other Markdown formatting as you see fit.

1. Feel free to add figure captions and in text cross-references.
]

<div class="countdown" id="timer_5f7d4024" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


---
class: middle, center, inverse

&lt;span class="fa-stack fa-4x"&gt;
  &lt;i class="fa fa-circle fa-stack-2x" style="color: #fff;"&gt;&lt;/i&gt;
  &lt;strong class="fa-stack-1x" style="color:#2f5275;"&gt;3 &lt;/strong&gt;
&lt;/span&gt; 


# Combine figures in output

---

# Arrange plots in a grid


`cowplot::plot_grid()` for multi-panel plots

.footnote[https://wilkelab.org/cowplot/articles/plot_grid.html]

---
class: live-code

# Live code demo

We start with `03-draft-revised.Rmd` and combine `age_density` and `age_boxplot` with the `cowplot` package.


```r
plot_grid(age_density, age_boxplot, labels = "AUTO")
```

&lt;img src="03-graphics_files/figure-html/unnamed-chunk-18-1.png" width="70%" style="display: block; margin: auto;" /&gt;


---
class: your-turn

# Your turn

## Make a plot grid

Open up your `03-draft-revised.Rmd`.

Combine `surv_pct_plot` and `surv_days_plot` with `cowplot::plot_grid()`.


_psst...my answers on the next slide..._

<div class="countdown" id="timer_5f7d3dd8" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
class: your-turn

# Answers

````
```{r echo=FALSE, fig.retina=3, fig.asp=.5, fig.width=20}
plot_grid(surv_pct_plot, surv_days_plot, labels = "AUTO")
```
````

&lt;img src="03-graphics_files/figure-html/unnamed-chunk-20-1.png" width="720" style="display: block; margin: auto;" /&gt;


---
class: middle, center, inverse

&lt;span class="fa-stack fa-4x"&gt;
  &lt;i class="fa fa-circle fa-stack-2x" style="color: #fff;"&gt;&lt;/i&gt;
  &lt;strong class="fa-stack-1x" style="color:#2f5275;"&gt;4 &lt;/strong&gt;
&lt;/span&gt; 

# Get figures out

---

# Exporting plots


```r
ggsave()
```


---

# fig.path

````
```{r ae-plot, fig.path="figs/", echo=FALSE}
ae_pct_plot
```
````

&lt;img src="03-graphics_files/figure-html/ae-plot-1.png" width="70%" /&gt;


---
class: live-code

# Live code demo

We open up `03-draft-revised.Rmd` and together we:

1. Add `fig.path="figs/"` as a `knitr` code chunk option for a single plot _(watch what happens if we don't include the backslash!)_

1. Knit and behold

1. We add a global `setup` chunk, if we have time.

---
class: live-code

# A global `setup` chunk

One chunk to rule them all

````
```{r setup, include = FALSE}
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  fig.retina = 3,
  fig.path = here::here("alison-figs/")
)
```
````

---

# ⭐ Tip

http://zevross.com/blog/2017/06/19/tips-and-tricks-for-working-with-images-and-figures-in-r-markdown-documents/

&lt;iframe src="http://zevross.com/blog/2017/06/19/tips-and-tricks-for-working-with-images-and-figures-in-r-markdown-documents/" width="100%" height="400px"&gt;&lt;/iframe&gt;



---
class: middle, center

# ⏱

# Time for a break!

<div class="countdown blink-colon noupdate-15" id="timer_5f7d3d4a" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>



    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "dracula",
"highlightLanguage": ["r", "yaml", "markdown"],
"slideNumberFormat": "",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
